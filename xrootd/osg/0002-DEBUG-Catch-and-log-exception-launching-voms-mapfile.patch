From 084799f1bb977e10ccb48b9a74cb22f2ab88e1ef Mon Sep 17 00:00:00 2001
From: Matyas Selmeci <matyas@cs.wisc.edu>
Date: Wed, 21 Dec 2022 13:51:57 -0600
Subject: [PATCH] DEBUG: Catch and log exception launching voms mapfile
 monitoring thread

---
 src/XrdVoms/XrdVomsMapfile.cc | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/XrdVoms/XrdVomsMapfile.cc b/src/XrdVoms/XrdVomsMapfile.cc
index ededb473a..e0b53e2ef 100644
--- a/src/XrdVoms/XrdVomsMapfile.cc
+++ b/src/XrdVoms/XrdVomsMapfile.cc
@@ -85,12 +85,17 @@ XrdVomsMapfile::XrdVomsMapfile(XrdSysError *erp,
     } else {
         m_edest->Log(LogMask::Debug, "XrdVomsMapfile", "Parsing voms mapfile succeeded");
     }
 
     pthread_t tid;
-    auto rc = XrdSysThread::Run(&tid, XrdVomsMapfile::MaintenanceThread,
-                                static_cast<void*>(this), 0, "VOMS Mapfile refresh");
+    try {
+        auto rc = XrdSysThread::Run(&tid, XrdVomsMapfile::MaintenanceThread,
+                                    static_cast<void*>(this), 0, "VOMS Mapfile refresh");
+    } catch (const std::exception& e) {
+        m_edest->Emsg("XrdVomsMapfile", "Launch of VOMS mapfile monitoring thread died with exception", e.what());
+        throw;
+    }
     if (rc) {
         m_edest->Emsg("XrdVomsMapfile", "Failed to launch VOMS mapfile monitoring thread");
         return;
     } else {
         m_edest->Log(LogMask::Debug, "XrdVomsMapfile", "VOMS mapfile monitoring thread launched");
-- 
2.39.0

