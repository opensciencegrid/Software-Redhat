# Configure VOMS authentication for XRootD installations
#
# **********************************************************************
# * WARNING: DO NOT EDIT THIS FILE.  IT WILL BE OVERWRITTEN ON UPGRADE *
# **********************************************************************
#
# This file is part of the osg-xrootd package
#
# Instead of editing this file:
# - Modify /etc/xrootd/config.d/10-osg-xrdvoms.cfg to enable the default
#   configuration
# - Override OSG-provided defaults by dropping a site-specific configuration
#   file in `/etc/xrootd/config.d` and prefixing it with "90-" or higher.

if defined ?GridMapfile
    # pass
else
    set GridMapfile=/etc/grid-security/grid-mapfile
fi

if defined ?GmapOpt
    # pass
else
    set GmapOpt=trymap
fi

# Ensure that the var for which VOMS FQANs to consider is defined
if defined ?vomsfqans
    # do nothing
else
    set vomsfqans = usefirst
fi

if defined ?EnableVoms
    xrootd.seclib /usr/lib64/libXrdSec.so
    sec.protocol /usr/lib64 gsi -certdir:/etc/grid-security/certificates \
                        -cert:/etc/grid-security/xrd/xrdcert.pem \
                        -key:/etc/grid-security/xrd/xrdkey.pem \
                        -crl:try \
                        -showdn:true \
                        -vomsfun:libXrdVoms.so \
                        -vomsfunparms:certfmt=pem|grpopt=$(vomsfqans) \
                        -gmapopt:$(GmapOpt) -gmapto:0 \
                        -gridmap:$(GridMapfile)
fi
